<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAT201 Assignment 1</title>
    <link rel="stylesheet" href="index.css">
</head>

<body class="index-page">

    <header>
        <a href="index.html" class="logo-link">
            <div class="logo-container">
                <img src="Picture/Icon.png" alt="Convert4U Icon">
                <h1>Convert4U</h1>
            </div>
        </a>
        <div class="navigation-container">
            <a href="index.html" class="active" onclick="setActiveLink(this)">All-in-One Mode</a>
            <a href="pdfToText.html" onclick="setActiveLink(this)">PDF to Text</a>
            <a href="textToPdf.html" onclick="setActiveLink(this)">Text to PDF</a>
            <a href="about.html" onclick="setActiveLink(this)">About</a>
        </div>
    </header>

    
    <form action="upload.php" method="post" enctype="multipart/form-data">

        <div class="converter-section animate-fade-in">

       

            <h2 style="font-size: 2em; margin: 10px;">
                Convert <span id="typing-effect"></span>
            </h2>
      
            <div id="flash-container">
                <p class="flash-text" style="white-space: nowrap;">No download</p>
                <p class="flash-text" style="white-space: nowrap;">No installation</p>
                <p class="flash-text" style="white-space: nowrap;">No hassle</p>
            </div>

            <div class="converter-container">
                <div class="converter-input-section">

                        <div id="selected-files-section">
                            <label for="file">Select one or more files: </label>
                            <!-- <input type="file" id="file" name="files[]" accept=".pdf, .txt" multiple required onchange="displaySelectedFiles()"> -->
                            <label for="file" class="custom-file-upload">
                                <span>Choose File</span>
                                <input type="file" id="file" name="files[]" accept=".pdf, .txt" multiple required onchange="displaySelectedFiles()">
                            </label>
                       
                        </div>
                    
                        <!-- <label for="file">Select one or more files (PDF or TXT):</label> -->
                        <div id="drop-area-card">
                            <div id="drop-area" ondragover="allowDrop(event)" ondrop="dropHandler(event)" ondragleave="resetDropArea()" onchange="displaySelectedFiles()">
                                üìÅ Drag and drop your files here
                              
                            </div>
                        </div>
                      


                </div>

                <div class="converter-output-section">
                    <div id="selectedFiles">
                        <p id="selectedFilesTitle">Selected Files:</p>
                    </div>
            </div>
           
        </div>

    
        <button type="submit" onclick="convertFiles()" class="custom-file-upload">
            <span>Convert</span>
        </button>
    </form>
        
    
    
        

        
    

    <section>
        <!-- Your drag and drop area can be added here -->
        
        <!-- Instructions for using the application can be placed here -->
    </section>

    <footer>
        <p>¬© 2023 CAT201 Group 22. All rights reserved.</p>
        <!-- Additional information about your team can be added here -->
    </footer>

    <script>
        
        const flashTexts = document.querySelectorAll('.flash-text');

     
        
        function getOffsetLeft(index) {
            // Add logic to determine the left offset based on the index
            switch (index) {
                case 0:
                    return '-700px';
                case 1:
                    return '-0%'; // Centered offset
                case 2:
                    return '400%'; // Left-aligned offset
                // Add more cases for additional positions
                default:
                    return '0px'; // Default to 0px if index is not recognized
            }
        }

        function flashText(index) {
            flashTexts.forEach((text, i) => {
                if (i === index) {
                    text.style.display = 'inline';
                    text.style.marginLeft = getOffsetLeft(index);
                } else {
                    text.style.display = 'none';
                }
            });
        }

     

        function startFlashing() {
            let index = 0;
            setInterval(() => {
                flashText(index);
                index = (index + 1) % flashTexts.length;
            }, 2000); // Change the interval as needed (milliseconds)
        }

        startFlashing();

        document.addEventListener("DOMContentLoaded", function () {
            var text = "PDF and TXT file ALL at once!";
            var speed = 100; // Adjust the typing speed (milliseconds)

            function typeWriter(text, index) {
                if (index < text.length) {
                    // document.getElementById("typing-effect").innerHTML += text.charAt(index);
                    if (text.charAt(index) === 'A' || text.charAt(index) === 'L') {
                        // document.getElementById("typing-effect").innerHTML += '<span style="color: #ffffff;">' + text.charAt(index) + '</span>';
                        document.getElementById("typing-effect").innerHTML += '<span style="color: #00ff00;">' + text.charAt(index) + '</span>';

                    } else {
                        document.getElementById("typing-effect").innerHTML += text.charAt(index);
                    }
                    index++;
                    setTimeout(function () {
                        typeWriter(text, index);
                    }, speed);
                }
            }

            // Trigger the typing effect on page load
            typeWriter(text, 0);
        });
        



        function setActiveLink(clickedLink) {
            // Remove active class from all links
            var links = document.querySelectorAll('.navigation-container a');
            links.forEach(function (link) {
                link.classList.remove('active');
            });
        
            // Add active class to the clicked link
            clickedLink.classList.add('active');
        }

        function allowDrop(event) {
            event.preventDefault();
            // document.getElementById('drop-area').innerText = 'drop your file to here';

            var dropArea = document.getElementById('drop-area');
            dropArea.innerText = 'Drop your files here like magic! ‚ú®';
            dropArea.style.borderColor = '#42a5f5'; // Change the border color to a desired color
        }



        function dropHandler(event) {
            event.preventDefault();

            var input = document.querySelector('input[type="file"]');
            var output = document.getElementById('selectedFiles');
            var droppedFiles = event.dataTransfer.files;

            for (var i = 0; i < droppedFiles.length; ++i) {
                if (droppedFiles[i].type !== 'application/pdf' && droppedFiles[i].type !== 'text/plain') {
                    displayFailMessage();
                    // Display an error message for non-PDF files
                    setTimeout(function () {
                        resetDropArea();
                    }, 2000);

                    // Reset the selected files display
                    // output.innerHTML = '';
                    return;
                }
            }

            for (var i = 0; i < event.dataTransfer.files.length; ++i) {
                var file = event.dataTransfer.files[i];

                // Update the input element with the dropped file
                // updateInputFiles(file);

                output.innerHTML += '<p>' + event.dataTransfer.files[i].name + '</p>';
            }
            
            // Update the input element with the dropped files
            updateInputFiles(event.dataTransfer.files);

            // Display success message
            // output.innerHTML += '<p style="color: green;">File(s) added successfully!</p>';
            displaySuccessMessage();

            // Reset drop area text after a short delay
            setTimeout(function () {
                resetDropArea();
            }, 2000);
        }

        function updateInputFiles(droppedFiles) {
            var input = document.querySelector('input[type="file"]');
            var output = document.getElementById('selectedFiles');

            // Create a new FormData object
            var formData = new FormData();

            // Append the existing files to the FormData object

            for (var i = 0; i < input.files.length; ++i) {
                formData.append('files[]', input.files[i]);
            }

            for (var i = 0; i < droppedFiles.length; ++i) {
                formData.append('files[]', droppedFiles[i]);
            }
        
            
            // // // Append the dropped file to the FormData object
            // // formData.append('files[]', droppedFiles);
            
            // Update the input element's FormData
            // input.formData = formData.getAll('files[]');
            // input.files = formData.getAll('files[]');

             // Create a new file input element
            var newInput = document.createElement('input');
            newInput.type = 'file';
            newInput.name = 'files[]';
            newInput.multiple = true;

            // Create a new FileList object for the new input element
            var newFileList = new DataTransfer();
                    
            // Append the new files to the new input element
            for (var pair of formData.entries()) {
                // newInput.files.push(pair[1]);
                newFileList.items.add(pair[1]);
                // output.innerHTML += '<p>' + pair[0] + ': ' + pair[1].name + "is push" + '</p>';
            }

            // Set the files for the new input element
            newInput.files = newFileList.files;
        
            // Replace the existing input element with the new one
            input.parentNode.replaceChild(newInput, input);
            
        
            // Clear the output
            // output.innerHTML = '';
        
            // Output all elements in the FormData object
   
        }

        function displaySuccessMessage() {
            var dropArea = document.getElementById('drop-area');
            dropArea.innerText = 'Files successfully added! ‚úîÔ∏è';
            dropArea.style.color = 'lightgreen';
            dropArea.style.fontWeight = 'bold';

            // // Call updateInputFiles to ensure the input element is updated
            // updateInputFiles([]);
                    
            // // Call convertFiles after files are dropped and success message is displayed
            // convertFiles();
        }

        function displayFailMessage() {
            var dropArea = document.getElementById('drop-area');
            dropArea.innerText = 'Only PDF or TXT files are allowed! ‚ùå';
            dropArea.style.color = 'red';
            dropArea.style.fontWeight = 'bold';
        }

   

        function resetDropArea() {
            var dropArea = document.getElementById('drop-area');
            dropArea.innerText = 'üìÅ Drag and drop your files here';
            dropArea.style.color = 'white'; // Reset the color to default
            dropArea.style.fontWeight = 'normal'; // Reset the font weight to normal
            dropArea.style.borderColor = '#aaaaaa';
        }


        function displaySelectedFiles() {
            var input = document.querySelector('input[type="file"]');
            var output = document.getElementById('selectedFiles');
            // output.innerHTML = '<p>Selected Files:</p>';
            
            for (var i = 0; i < input.files.length; ++i) {
                output.innerHTML += '<p>' + input.files[i].name + '</p>';
            }
        }

        function convertFiles() {
            var form = document.querySelector('form');
            var formData = new FormData(form);

            // Use formData to send to PHP or perform any other actions
            // ...

            // Example: Send data using fetch
            fetch('upload.php', {
                method: 'POST',
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                // Handle success, if needed
            })
            .catch(error => {
                console.error('Error:', error);
                // Handle errors, if needed
            });
        }

    </script>
</body>

</html>
